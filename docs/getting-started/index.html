<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Getting started - Okapi Docs</title>
    <meta name="generator" content="Hugo 0.30.2" />

    
    <meta name="description" content="A PROS library for fast C&#43;&#43; development.">
    
    <link rel="canonical" href="https://okapilib.github.io/OkapiLib/getting-started/">
    
    <meta name="author" content="OkapiLib">
    

    <meta property="og:url" content="https://okapilib.github.io/OkapiLib/getting-started/">
    <meta property="og:title" content="Okapi Docs">
    <meta property="og:image" content="https://okapilib.github.io/OkapiLib/images/okapi.jpg">
    <meta name="apple-mobile-web-app-title" content="Okapi Docs">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://okapilib.github.io/OkapiLib/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://okapilib.github.io/OkapiLib/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://okapilib.github.io/OkapiLib/fonts/icon.eot');
        src: url('https://okapilib.github.io/OkapiLib/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://okapilib.github.io/OkapiLib/fonts/icon.woff')
               format('woff'),
             url('https://okapilib.github.io/OkapiLib/fonts/icon.ttf')
               format('truetype'),
             url('https://okapilib.github.io/OkapiLib/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://okapilib.github.io/OkapiLib/stylesheets/application.css">
    <link rel="stylesheet" href="https://okapilib.github.io/OkapiLib/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://okapilib.github.io/OkapiLib/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://okapilib.github.io/OkapiLib/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://okapilib.github.io/OkapiLib/css/imageAlign.css">
    
    <script src="https://okapilib.github.io/OkapiLib/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Getting started
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/OkapiLib" title="@OkapiLib on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/OkapiLib/OkapiLib" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://okapilib.github.io/OkapiLib/images/okapi.jpg">
        </div>
      
      <div class="name">
        <strong>Okapi Docs <span class="version">0.2.4</span></strong>
        
          <br>
          OkapiLib/OkapiLib
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/OkapiLib/OkapiLib/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/OkapiLib/OkapiLib/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Home" href="https://okapilib.github.io/OkapiLib/home/">
	
	Home
</a>



  
</li>



<li>
  
    



<a class="current" title="Getting started" href="https://okapilib.github.io/OkapiLib/getting-started/">
	
	Getting started
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Tutorials" href="https://okapilib.github.io/OkapiLib/tutorials/">
	
	Tutorials
</a>



  
</li>



<li>
  
    



<a  title="API" href="https://okapilib.github.io/OkapiLib/api/">
	
	API
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://okapilib.github.io/OkapiLib/license/">
	
	License
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/OkapiLib" target="_blank" title="@OkapiLib on GitHub">
              @OkapiLib on GitHub
            </a>
          </li>
          

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Getting started </h1>

			

<h2 id="programming-the-clawbot">Programming the Clawbot</h2>

<p>This tutorial is a step-by-step guide to programming this simple skills robot:</p>


<figure >
    
        <img src="https://okapilib.github.io/OkapiLib/images/skillsRobotPicture.jpg#center" />
    
    
</figure>


<p>This robot has motors and sensors plugged into the following ports:</p>

<table>
<thead>
<tr>
<th>Motor Port</th>
<th>Description</th>
<th>Motor Port</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td></td>
<td>6</td>
<td>Right middle motor</td>
</tr>

<tr>
<td>2</td>
<td>Left front motor</td>
<td>7</td>
<td>Right bottom motor</td>
</tr>

<tr>
<td>3</td>
<td>Left middle motor</td>
<td>8</td>
<td>Lift left motor</td>
</tr>

<tr>
<td>4</td>
<td>Left bottom motor</td>
<td>9</td>
<td>Lift right motor</td>
</tr>

<tr>
<td>5</td>
<td>Right top motor</td>
<td>10</td>
<td></td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>Digital Port</th>
<th>Description</th>
<th>Digital Port</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Left encoder top wire</td>
<td>7</td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>Left encoder bottom wire</td>
<td>8</td>
<td></td>
</tr>

<tr>
<td>3</td>
<td>Right encoder top wire</td>
<td>9</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>Right encoder bottom wire</td>
<td>10</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td></td>
<td>11</td>
<td></td>
</tr>

<tr>
<td>6</td>
<td></td>
<td>12</td>
<td></td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>Analog Port</th>
<th>Description</th>
<th>Analog Port</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Lift potentiometer</td>
<td>5</td>
<td></td>
</tr>

<tr>
<td>2</td>
<td></td>
<td>6</td>
<td></td>
</tr>

<tr>
<td>3</td>
<td></td>
<td>7</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td></td>
<td>8</td>
<td></td>
</tr>
</tbody>
</table>

<h2 id="project-configuration">Project Configuration</h2>

<p>After installing OkapiLib through the PROS Conductor tool, <code>okapilib.a</code> will be copied into <code>firmware/</code> and OkapiLib&rsquo;s header files will be copied into <code>include/</code>. In order to properly compile your project, you need to modify a few files:</p>

<ol>
<li><p>The <code>src/</code> folder contains three files, <code>auto.c</code>, <code>init.c</code>, and <code>opcontrol.c</code>. The <code>.c</code> extension of these files needs to be changed to <code>.cpp</code> so the compiler knows they contain C++ code.</p></li>

<li><p>The <code>src/init.cpp</code> file needs to be changed so it instead contains the following code which calls a special internal function <code>__libc_init_array()</code>:</p></li>
</ol>

<pre><code class="language-c++">#include &quot;main.h&quot;

extern &quot;C&quot; {
  void __libc_init_array();
}

void initializeIO() {
  __libc_init_array();
}

void initialize() {
}
</code></pre>

<ol>
<li>Finally, the <code>common.mk</code> file needs to have the <code>CPPFLAGS</code> variable modified to contain the flag <code>-std=c++14</code> so the compiler knows the correct C++ standard to use:</li>
</ol>

<p>This line: <code>CPPFLAGS:=$(CCFLAGS)-fno-exceptions -fno-rtti -felide-constructors</code></p>

<p>Should become this: <code>CPPFLAGS:=$(CCFLAGS) -std=c++14 -fno-exceptions -fno-rtti -felide-constructors</code></p>

<h2 id="programming-user-control">Programming User Control</h2>

<h3 id="drivetrain-setup">Drivetrain Setup</h3>

<p>Let&rsquo;s start by setting up our sensor and motor configuration. We want to tell Okapi that we have two quadrature encoders and six motors on our chassis.</p>

<p>Our two quad encoders:</p>

<pre><code class="language-c++">QuadEncoder leftEnc(1, 2, true), rightEnc(3, 4);
</code></pre>

<p>Now we can use those quads with our motors to make a model for controlling our chassis:</p>

<pre><code class="language-c++">SkidSteerModel&lt;3&gt; model({2_m, 3_m, 4_m, 5_m, 6_m, 7_m}, leftEnc, rightEnc);
</code></pre>

<p>That syntax might look a little weird. Breaking it down further, the template argument to our <code>SkidSteerModel</code> specifies the number of motors per side we have. In our case, we have three motors on each side of our chassis, so the argument value is <code>3</code>. Next, the first argument to the <code>SkidSteerModel</code> constructor is an array of motors. Each motor is specified using special syntax called a literal, which lets you abbreviate the <code>Motor</code> constructor. Writing <code>2_m</code> translates into <code>Motor(2, false)</code>, which is a non-reversed motor on port two. <code>2_rm</code> would translate into <code>Motor(2, true)</code>, which is a reversed motor on port two.</p>

<p>It&rsquo;s a good idea to use PID control to have the chassis drive around accurately during autonomous. Okapi can do this using a <code>ChassisController</code>, which combines a <code>ChassisModel</code> with either PID or Motion Profile control. Let&rsquo;s refactor to use that instead:</p>

<pre><code class="language-c++"> ChassisControllerPid controller(SkidSteerModelParams&lt;3&gt;({2_m,3_m,4_m, 5_m,6_m,7_m}, leftEnc, rightEnc),
                                 PidParams(0.15, 0.05, 0.07),
                                 PidParams(0.02, 0.01, 0));
</code></pre>

<p>Take a look at the first argument to the <code>ChassisControllerPid</code> constructor. It looks just like our model from before, except it has a <code>Parmas</code> suffix now. Okapi often encapsulates the constructor arguments of classes into their own <code>Params</code> class to simplify making complex objects. Notice we do the same thing for the remaining two arguments, <code>PidParams</code> specifies how to make a <code>Pid</code> controller.</p>

<p>To recap, this is the final state of our chassis setup code:</p>

<pre><code class="language-c++">QuadEncoder leftEnc(1, 2, true), rightEnc(3, 4);
ChassisControllerPid controller(SkidSteerModelParams&lt;3&gt;({2_m,3_m,4_m, 5_m,6_m,7_m}, leftEnc, rightEnc),
                                PidParams(0.15, 0.05, 0.07),
                                PidParams(0.02, 0.01, 0));
</code></pre>

<h3 id="lift-setup">Lift Setup</h3>

<p>Okapi provides a tool, called <code>GenericController</code>, to associate a group of motors to some closed-loop controller. We want to use this for our lift because all of the lift motors should act like one, so it&rsquo;s easier to think about in that manner. Let&rsquo;s tie our two lift motors together and control them with a special PID controller, called <code>NsPid</code>, that moniors velocity and reduces the control signal at low velocity to prevent the system from stalling itself.</p>

<pre><code class="language-c++">GenericController&lt;2&gt; liftController({8_m, 9_m},
                                    std::make_shared&lt;NsPid&gt;(NsPid(PidParams(0.2, 0.1, 0.1), 
                                                            VelMathParams(360),
                                                            0.5)));
</code></pre>

<p>Like before, we specify our two motors in an array using motor literals, and we specify the number of motors using the template argument. These two motors will recieve the control signal from the closed-loop controller we specify in the second argument. Notice that because <code>GenericController</code> accepts an abstract <code>ControlObject</code>, we cannot supply a concrete class directly. Instead, we must make a <code>std::shared_ptr</code> to our concrete class.</p>

<h3 id="control-code">Control Code</h3>

<p>We&rsquo;ll have a simple state machine that controls the lift&rsquo;s target height:</p>

<pre><code class="language-c++">const unsigned char liftPot = 1;
constexpr int liftUpTarget = 2570, lift34 = 300, liftDownTarget = 10;
int target = liftUpTarget;

while (1) {
  if (joystickGetDigital(1, 6, JOY_UP))
    target = liftUpTarget;
  else if (joystickGetDigital(1, 6, JOY_DOWN))
    target = liftDownTarget;
  else if (joystickGetDigital(1, 5, JOY_UP))
    target = lift34;
  else if (joystickGetDigital(1, 8, JOY_LEFT)) {
    liftController.flipDisable(); //Turn the controller on or off
    while (joystickGetDigital(1, 8, JOY_LEFT)); //And wait
  }

  liftController.setTarget(target); //Set the new target
  liftController.loop(analogRead(liftPot)); //Loop the controller
}
</code></pre>

<p>Let&rsquo;s also use arcade control to drive around ourselves:</p>

<pre><code class="language-c++"> controller.arcade(joystickGetAnalog(1, 2), joystickGetAnalog(1, 1));
</code></pre>

<h2 id="review">Review</h2>

<p>That&rsquo;s all the code we need to drive around and use the lift. Here&rsquo;s our final product:</p>

<pre><code class="language-c++">#include &lt;cmath&gt;
#include &quot;main.h&quot;
#include &lt;chassis/basicChassisController.h&gt;
#include &lt;control/nsPid.h&gt;
#include &lt;control/genericController.h&gt;

using namespace okapi;

void operatorControl() {
  using namespace std; //Needed to get round to compile
  
  QuadEncoder leftEnc(1, 2, true), rightEnc(3, 4);
  ChassisControllerPid controller(SkidSteerModelParams&lt;3&gt;({2_m,3_m,4_m, 5_m,6_m,7_m}, leftEnc, rightEnc),
                                  PidParams(0.15, 0.05, 0.07),
                                  PidParams(0.02, 0.01, 0));

  const unsigned char liftPot = 1;

  GenericController&lt;2&gt; liftController({8_m, 9_m},
                                      std::make_shared&lt;NsPid&gt;(NsPid(PidParams(0.2, 0.1, 0.1),
                                                                    VelMathParams(360),
                                                                    0.5)));

  constexpr int liftUpTarget = 2570, lift34 = 300, liftDownTarget = 10;
  int target = liftUpTarget;

  while (1) {
    if (joystickGetDigital(1, 6, JOY_UP))
      target = liftUpTarget;
    else if (joystickGetDigital(1, 6, JOY_DOWN))
      target = liftDownTarget;
    else if (joystickGetDigital(1, 5, JOY_UP))
      target = lift34;
    else if (joystickGetDigital(1, 8, JOY_LEFT)) {
      liftController.flipDisable();
      while (joystickGetDigital(1, 8, JOY_LEFT));
    }

    liftController.setTarget(target);
    liftController.loop(analogRead(liftPot));

    controller.arcade(joystickGetAnalog(1, 2), joystickGetAnalog(1, 1));
  }
}
</code></pre>


			<aside class="copyright" role="note">
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://okapilib.github.io/OkapiLib/api/" title="API Reference">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              API Reference
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://okapilib.github.io/OkapiLib/license/" title="License">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              License
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/okapilib.github.io\/OkapiLib\/';
      var repo_id  = 'OkapiLib\/OkapiLib';
    
    </script>

    <script src="https://okapilib.github.io/OkapiLib/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-108357936-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

